syntax = "proto3";

option go_package = "../pb";

package media;

message FileMetadata {
    string file_name = 1;
    string content_type = 2;
    string uploader_id = 3;
}

// What the API Hub sends to the Media Engine
message FileUploadRequest {
    // We use a 'oneof' because the first message needs to be the metadata (filename),
    // and all subsequent messages in the stream will be the raw binary chunks.
    oneof request {
        FileMetadata metadata = 1;
        bytes chunk_data = 2;
    }
}

// What the Media Engine replies with once the upload finishes
message FileUploadResponse {
    string file_id = 1;
    string file_url = 2;
    bool success = 3;
}

// The actual Service definition
service MediaService {
    // UploadFile accepts a STREAM of data chunks and returns one response
    rpc UploadFile(stream FileUploadRequest) returns (FileUploadResponse);
}